<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GitHub Paint! v.1</title>
    <script src="./angular.js"></script>
    <script src="./jquery.js"></script>
    <style>
        .pl-2 {
            padding-left: 8px !important;
        }

        .float-left {
            float: left !important;
        }

        .col-9 {
            width: 75%;
        }

        .py-2 {
            padding-top: 8px !important;
            padding-bottom: 8px !important;
        }

        .mb-5 {
            margin-bottom: 32px !important;
        }

        .rounded-1 {
            border-radius: 3px !important;
        }

        .border-gray-dark {
            border-color: #d1d5da !important;
        }

        .border {
            border: 1px #e1e4e8 solid !important;
        }

        * {
            box-sizing: border-box;
        }

        user agent stylesheet div {
            display: block;
        }

        body {
            min-width: 1020px;
            word-wrap: break-word;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 14px;
            line-height: 1.5;
            color: #24292e;
            background-color: #fff;
            background-color: #dcd4d4;
            padding: 0;
            margin: 0;
        }

        table {
            border: 1px solid black;
            background-color: pink;
            margin: 10px;
        }

        a {
            color: #0366d6;
            text-decoration: none;
            background-color: transparent;
        }

        user agent stylesheet a:-webkit-any-link {
            color: -webkit-link;
            cursor: pointer;
            text-decoration: underline;
        }

        .text-gray {
            color: #586069 !important;
        }

        .contrib-legend {
            float: right;
        }

        .text-gray {
            color: #586069 !important;
        }

        * {
            box-sizing: border-box;
        }

        user agent stylesheet div {
            display: block;
        }

        .contrib-footer {
            padding: 5px 23px 20px 23px;
            font-size: 11px;
        }

        .contrib-legend .legend {
            position: relative;
            bottom: -1px;
            display: inline-block;
            margin: 0 5px;
            list-style: none;
            padding: 0;
        }

        .contrib-legend .legend li {
            display: inline-block;
            width: 10px;
            height: 10px;
        }

        .calendar-graph text.wday {
            font-size: 9px;
            fill: #767676;
        }

        .calendar-graph text.month {
            font-size: 10px;
            fill: #767676;
            background-color: darkred;
            transform: translateX(53px);
            position: relative;
        }

        .graph-canvas {
            padding-left: 12px;
        }

        .js-contribution-graph {
            margin: 0;
            width: 726px;
        }

        #currentColor {
            display: block;
            width: 150px;
            height: 150px;
            border: 1px solid black;
        }

        .mini-help {
            font-size: 10px;
        }

        #result-img {
            width: 53px;
            height: 7px;
            border: unset;
            transform: scale(5);
            background-color: #ebedf0;
            box-shadow: 0 0 0.1px #00BCD4;
            margin: 20px;
            left: 109px;
            position: relative;
        }

        .text-result-1 {
            width: 40%;
            min-height: 350px;
        }

        .text-result-2 {
            width: 60%;
            min-height: 350px;
            position: absolute;
        }
        .drag-zone{
            width: 200px;
            height: 100px;
            border: 1px solid #b3b3b3;
            border-radius: 10px;
            margin: 10px;
            background-color: #f3f3f3;
            text-align: center;
            line-height: 100px;
            font-size: 11px;
            color: gray;
        }
    </style>

    <template>
            # git contributions image

            clear
            
            echo "---------------" 
            echo "- FUN!        -" 
            echo "---------------" 
            
            
            # init config vars
            
            var_image="null" 
            var_repo_name="[[MAIL]]"
            # "2012-01-15"
            var_start_date="[[DATE]]"
            var_author_name="[[AUTHOR]]"
            var_author_mail="[[AUTHOR_MAIL]]"
            var_file_name="[[FILENAME]]"
            # "My default commit message"
            var_commit_message="[[COMMIT_MESSAGE]]"
            
            
            # ------------
            # Create repo
            # ------------
            
            echo "[1] Be happy! We are about to create the repo: " ${var_repo_name}
            git init ${var_repo_name}
            cd ${var_repo_name}
            
            
            # -----------------
            # Add file to repo
            # -----------------
            
            echo "/* ${var_repo_name} */" > ${var_file_name}
            
            
            # ---------------------------------
            # Loop over days & commits per day
            # ---------------------------------
            
            count_commmits=0
            count_days=0
            count_commmits_in_day=0
            
            IFS=';'
            
            pwd
            ls -l
            
            var_increase_time=$((1+60*$count_commmits_in_day))
            echo "var_increase_time: ${var_increase_time}"
            
            file="../source.v3.txt"
            cat ${file}
            while read -r f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12
            do
            
                    if (test  "${f1:0:1}" = '#' ) || ( test  "${f1:0:1}" = ''  ); then
            
                            continue ;
                    else
            
                            var_commits_per_day="0"
            
                            if (test  "${f8}" = 'color-0' ); then 
                                    var_commits_per_day="0" 
                            fi
            
                            if (test  "${f8}" = 'color-1' ); then 
                                    var_commits_per_day="1"
                            fi
            
                            if (test  "${f8}" = 'color-2' ); then 
                                    var_commits_per_day="4"
                            fi
            
                            if (test  "${f8}" = 'color-3' ); then 
                                    var_commits_per_day="7"
                            fi
            
                            if (test  "${f8}" = 'color-4' ); then 
                                    var_commits_per_day="11"
                            fi
            
                            printf "\n***********************************************************************************\n"
                            printf 'Data: %s, %s, %s, %s, %s, %s, %s, %s %s, %s, %s\n' "$f1" "$f2" "$f3" "$f4" "$f5" "$f6" "$f7" "$f8" "$f9" "$f10" "$f11" "$f11"
                            printf "Day %s has %s commits.\n" "$f1" "$var_commits_per_day"
                            printf "***********************************************************************************\n"
            
                            count_days=`expr $count_days + 1` # days with 0 commits should be in the file! or the process will fail
                            count_commmits_in_day="0";
            
                            if (test  "${f8}" = '0' ); then 
            
                                    # 5 - This works fine!
            
                                    # Get total seconds from 'count_days' and 'count_commmits_in_day' values
                                    # 1 day will add 86400 seconds. 1 commit will add 60 seconds
                                    var_increase_time=$((86400*$count_days+60*$count_commmits_in_day))
                                    echo "var_increase_time: ${var_increase_time}"
            
                                    continue ; # Exit in the case of 0 commits
                            else
            
                                    for (( j=0; j < $var_commits_per_day; ++j )) # commits in a day
                                    do
                                            count_commmits=`expr $count_commmits + 1`
                                            count_commmits_in_day=`expr $count_commmits_in_day + 1`
                                            printf "\nCommit number ${count_commmits}. Commit message: '${var_commit_message}'\n"
            
                                            # Write change to file
                                            echo ${count_commmits} $'\r' >> ${var_file_name}
                                            git add .
            
                                            var_Ymd=${var_start_date} #"2012-01-01"
                                            var_HMS="12:00:00"
                                            var_date=$( date -j -v +"$var_increase_time"S -f "%Y-%m-%d %H:%M:%S" "$var_Ymd $var_HMS" +%Y-%m-%dT%H:%M:%S )
                                            echo "commit date: ${var_date}"
            
                                            # Do commit
                                            git commit -m "Commit number ${count_commmits}; ${var_commit_message}" --date "${var_date}" --author="${var_author_name} <${var_author_mail}>"
                                    done
            
                                    # Get total seconds from 'count_days' and 'count_commmits_in_day' values
                                    # 1 day will add 86400 seconds. 1 commit will add 60 seconds
                                    var_increase_time=$((86400*$count_days+60*$count_commmits_in_day))
                                    echo "var_increase_time: ${var_increase_time}"
                            fi
                    fi
                    
            done <"$file"
            
            echo "done!"

    </template>

    <script>
        var NUM_OF_WEEKS = 53;
        var START_DATE = "2012-01-15" //"15/01/2012"; // 2012-01-15

        function getRGB(str) {
            var match = str.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);
            return match ? {
                R: match[1],
                G: match[2],
                B: match[3],
                A: 1
            } : {};
        }

        function getHeader(startDate) {
            if (startDate == null) startDate = START_DATE;
            var h = ''
                + '# ----------------------\n'
                + '#  All starts here      \n'
                + '# ----------------------\n'
                + '#_START_DATE:' + startDate + '\n'
                + '# ----------------------\n'
                + '';
            return h
        }

        var myApp = angular.module('myApp', []);
        myApp.controller('AppController', ['$scope', function ($scope) {


            $scope.output = getHeader();
            $scope.val_1st_commit_date = START_DATE; //"06/01/2013"; // this day should be sunday
            $scope.val_mail = "mail@mail.com";
            $scope.val_author = "Unknown Author";
            $scope.val_weeks_num = NUM_OF_WEEKS;
            
            $scope.contributions_num = '0';
            $scope.currentColor = {
                color: "#196127",
                commits: 4
            };
            $scope.lastWeek = 0;
            $scope.lastDay = 0;

            $scope.setColor = function (colorValue, commits) {
                $scope.currentColor = {
                    color: colorValue,
                    commits: commits
                };
                console.log("$scope.currentColor:", $scope.currentColor);
            };

            $scope.paint = function (lastWeek, lastDay, event) {
                console.log("lastWeek:", lastWeek, ", lastDay:", lastDay);
                console.log("event:", event);
                $scope.lastWeek = lastWeek;
                $scope.lastDay = lastDay;
                $(event.target).css('fill', $scope.currentColor.color);
                $(event.target).attr('data-commits', $scope.currentColor.commits);
            };

            $scope.generateOutput = function () {
                var str = '';
                var week = 0
                var dayInWeek = 0
                var cont = 0;
                for (i = 0; i < $scope.val_weeks_num; i++) {

                    str += '\n# ------ week ' + (i + 1) + ' ------'

                    for (j = 0; j < 7; j++) {
                        cont++;
                        // 21;3;7;65535;65535;65535;65535;0;null;null;null
                        //str += '\n'+ cont +';'+ i +';'+ j +';65535;65535;65535;65535;0;null;null;null'
                        //str += '\n'+ cont +';'+ i +';'+ j +';R;G;B;A;0;null;null;null'
                        var dayEl = document.getElementById("week-" + i + "-" + (j + 1));
                        var fill = $(dayEl).css("fill");
                        var obj = $(dayEl);
                        //console.log("obj:", obj);
                        var commitsColor = 0;
                        if (obj[0].attributes["data-commits"] != undefined) commitsColor = obj[0].attributes["data-commits"].value || 0;
                        //console.log(getRGB( fill ) );
                        var col = getRGB(fill);
                        var commitDate = null;

                        // set num of commits
                        if ( commitsColor == 0) val_num_of_commits = 0;
                        if ( commitsColor == 1) val_num_of_commits = 1;
                        if ( commitsColor == 2) val_num_of_commits = 4;
                        if ( commitsColor == 3) val_num_of_commits = 7;
                        if ( commitsColor == 4) val_num_of_commits = 11;
                        str += '\n' + cont + ';' + i + ';' + j + ';' + col.R + ';' + col.G + ';' + col.B + ';' + col.A + ';' + "color-" + commitsColor + ';' + val_num_of_commits + ';' + $scope.val_mail + ';' + $scope.val_author + ';' + commitDate;
                    }
                }
                str += '\n# The end!';
                $scope.output = $scope.output + str;
                $scope.mail = $scope.val_mail;
                $scope.date = $scope.val_1st_commit_date;
                $scope.author = $scope.val_author;
                $scope.author_mail = $scope.val_mail;
                $scope.filename = "file.txt";
                $scope.commit_message = "Commit message";
                $scope.output2 = getTemplateContent( $scope.mail, $scope.date, $scope.author, $scope.author_mail, $scope.filename, $scope.commit_message );
            };

            $scope.reset = function (color) {
                for (i = 0; i < $scope.val_weeks_num; i++) {
                    for (j = 0; j < 7; j++) {
                        var dayEl = document.getElementById("week-" + i + "-" + (j + 1));
                        $(dayEl).attr("fill", color);
                        $(dayEl).css("fill", color);
                    }
                }
                $scope.output = getHeader();
            };

            $scope.resetResult = function (color) {
                $scope.output = getHeader();
            };

        }]);

        myApp.controller('ViewerController', ['$scope', function ($scope) {
            $scope.number = NUM_OF_WEEKS;
            $scope.getNumber = function (num) {
                return new Array(num);
            }
        }]);

        myApp.controller('MenuController', ['$scope', function ($scope) {

        }]);

        /* - read file - */
        function readTextFile(file) {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function (){
                if(rawFile.readyState === 4){
                    if(rawFile.status === 200 || rawFile.status == 0){
                        var allText = rawFile.responseText;
                        alert(allText);
                    }
                }
            }
            rawFile.send(null);
        }

        readTextFile('template/script.sh');


        /* - read template - */

        function getTemplateContent( mail, date, author, author_mail,filename,commit_message ) {
            var temp = document.getElementsByTagName("template")[0].innerHTML;
            temp = temp.replace('[[MAIL]]', mail);
            temp = temp.replace('[[DATE]]', date);
            temp = temp.replace('[[AUTHOR]]', author);
            temp = temp.replace('[[AUTHOR_MAIL]]', author_mail);
            temp = temp.replace('[[FILENAME]]', filename);
            temp = temp.replace('[[COMMIT_MESSAGE]]', commit_message);
            return temp
        }

    </script>
</head>

<body ng-controller="AppController">

    <hr> Drag a picture here:
    
    <div class="drag-zone">

        Drag here!
    </div>
    <hr>


    <div>
        <label for="">Current color:</label>
        <div>
            <div id="currentColor" ng-style="{'background-color':currentColor.color}"></div>
            {{currentColor}}
        </div>
    </div>

    <div>
        <label for=""> lastWeek, lastDay</label>
        <div>
            {{lastWeek}}, {{lastDay}}
        </div>
    </div>

    <div style="width: 100%;
    background-color: #f3f3f3;
    padding: 5px 25px;">
        <div class="js-contribution-graph ">

            <h2 class="f4 text-normal mb-2">
                {{ contributions_num }} contributions in the last year
            </h2>


            <div class="mb-5 border border-gray-dark rounded-1 py-2" style="background-color: white;" ng-controller="ViewerController">
                <div class="js-calendar-graph is-graph-loading graph-canvas calendar-graph height-full" data-graph-url="/users/ajsoriar/contributions"
                    data-url="/ajsoriar" data-from="2018-05-01" data-to="2018-05-05">
                    <svg width="676" height="104" class="js-calendar-graph-svg">
                        <g transform="translate(16, 20)">
                            <g id="week-{{$index}}" ng-attr-transform="translate({{ (($index) * 11 + 12) }} , 0)" ng-repeat="i in getNumber(number) track by $index">
                                <rect id="week-{{$index}}-1" ng-click="paint($index,1,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="0" fill="#ebedf0" data-count="0" data-date="2017-04-30"></rect>
                                <rect id="week-{{$index}}-2" ng-click="paint($index,2,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="12" fill="#ebedf0" data-count="0" data-date="2017-05-01"></rect>
                                <rect id="week-{{$index}}-3" ng-click="paint($index,3,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="24" fill="#ebedf0" data-count="0" data-date="2017-05-02"></rect>
                                <rect id="week-{{$index}}-4" ng-click="paint($index,4,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="36" fill="#ebedf0" data-count="0" data-date="2017-05-03"></rect>
                                <rect id="week-{{$index}}-5" ng-click="paint($index,5,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="48" fill="#ebedf0" data-count="0" data-date="2017-05-04"></rect>
                                <rect id="week-{{$index}}-6" ng-click="paint($index,6,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="60" fill="#ebedf0" data-count="0" data-date="2017-05-05"></rect>
                                <rect id="week-{{$index}}-7" ng-click="paint($index,7,$event)" class="day" width="10" height="10" ng-attr-x="{{$index}}" y="72" fill="#ebedf0" data-count="0" data-date="2017-05-06"></rect>
                            </g>

                            <text ng-attr-x="{{ 25 + (52 * ($index -1 )) }}" y="-10" class="month" ng-repeat="month in ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'] track by $index">{{month}}</text>

                            <text text-anchor="start" class="wday" dx="-14" dy="8" style="display: none;">Sun</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="20">Mon</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="32" style="display: none;">Tue</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="44">Wed</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="57" style="display: none;">Thu</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="69">Fri</text>
                            <text text-anchor="start" class="wday" dx="-14" dy="81" style="display: none;">Sat</text>
                        </g>
                    </svg>

                </div>
                <div class="contrib-footer clearfix mt-1 mx-3 px-3 pb-1">
                    <div class="float-left text-gray">

                        <a href="https://help.github.com/articles/why-are-my-contributions-not-showing-up-on-my-profile">
                            Learn how we count contributions</a>.
                    </div>
                    <div class="contrib-legend text-gray" title="A summary of pull requests, issues opened, and commits to the default and gh-pages branches.">Less
                        <ul class="legend">
                            <li style="background-color: #eee" ng-click="setColor('#eee',0)"></li>
                            <li style="background-color: #c6e48b" ng-click="setColor('#c6e48b',1)"></li>
                            <li style="background-color: #7bc96f" ng-click="setColor('#7bc96f',2)"></li>
                            <li style="background-color: #239a3b" ng-click="setColor('#239a3b',3)"></li>
                            <li style="background-color: #196127" ng-click="setColor('#196127',4)"></li>
                        </ul>More</div>
                </div>

            </div>
        </div>
    </div>

    <input type="button" value="Reset" ng-click="reset('#eee')" />

    <table>
        <tr>
            <td>From
                <div class="mini-help">This day should be sunday</div>
            </td>
            <td>To
                <div class="mini-help">Number of weeks</div>
                <div class="mini-help">Max 100</div>
            </td>
            <td>mail</td>
            <td>autror</td>
            </th>
            <tr>
                <td>
                    <input id="frm-date-from" type="date" ng-value="val_1st_commit_date" />
                </td>
                <td>
                    <input type="number" name="input" ng-model="val_weeks_num" min="1" max="100" required>{{val_weeks_num}}
                </td>
                <td>
                    <input id="frm-mail" type="email" ng-value="val_mail" />
                </td>
                <td>
                    <input id="frm-author" ng-value="val_author" />
                </td>
            </tr>
    </table>
    <br>

    <input type="button" value="Generate" ng-click="generateOutput()" />

    <br>
    <hr> Result image:
    <canvas id="result-img"></canvas>

    <hr>

    <div style="width: 90%">
        <input type="button" value="Reset" ng-click="resetResult('#eee')" />
        <hr>
        <textarea name="" id="" cols="30" rows="10" class="text-result-1">{{output}}</textarea>
        <textarea name="" id="" cols="30" rows="10" class="text-result-2">{{output2}}</textarea>
    </div>

</body>

</html>